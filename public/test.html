<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Page Agent Test</title>
		<style>
			body {
				font-family: system-ui, -apple-system, sans-serif;
				max-width: 800px;
				margin: 40px auto;
				padding: 20px;
				line-height: 1.6;
			}

			h1 {
				color: #333;
			}

			.section {
				margin: 30px 0;
				padding: 20px;
				background: #f5f5f5;
				border-radius: 8px;
			}

			button {
				padding: 10px 20px;
				margin: 5px;
				font-size: 14px;
				cursor: pointer;
				background: #007bff;
				color: white;
				border: none;
				border-radius: 4px;
			}

			button:hover {
				background: #0056b3;
			}

			pre {
				background: #fff;
				padding: 15px;
				border-radius: 4px;
				overflow-x: auto;
			}

			#output {
				min-height: 100px;
			}
		</style>
	</head>
	<body>
		<h1>ğŸš€ Page Agent Extension Test</h1>

		<div class="section">
			<h2>æµ‹è¯• 1: è·å–æ‰€æœ‰ Tabs</h2>
			<button onclick="testGetTabs()">è¿è¡Œ getTabs()</button>
			<pre id="output1">ç‚¹å‡»æŒ‰é’®è¿è¡Œæµ‹è¯•...</pre>
		</div>

		<div class="section">
			<h2>æµ‹è¯• 2: åœ¨å½“å‰ Tab æ‰§è¡Œä»£ç </h2>
			<button onclick="testExecuteCurrent()">
				è¿è¡Œ execute() - è·å–å½“å‰é¡µé¢æ ‡é¢˜
			</button>
			<pre id="output2">ç‚¹å‡»æŒ‰é’®è¿è¡Œæµ‹è¯•...</pre>
		</div>

		<div class="section">
			<h2>æµ‹è¯• 3: åœ¨å…¶ä»– Tab æ‰§è¡Œä»£ç </h2>
			<p>å…ˆæ‰“å¼€å‡ ä¸ªå…¶ä»– tabï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®</p>
			<button onclick="testExecuteOther()">
				åœ¨ç¬¬ä¸€ä¸ª Tab ä¸­è·å–æ ‡é¢˜
			</button>
			<pre id="output3">ç‚¹å‡»æŒ‰é’®è¿è¡Œæµ‹è¯•...</pre>
		</div>

		<script>
			async function testGetTabs() {
				const output = document.getElementById('output1')
				try {
					output.textContent = 'æ­£åœ¨è·å– tabs...'
					const tabs = await getTabs()
					output.textContent = JSON.stringify(tabs, null, 2)
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}

			async function testExecuteCurrent() {
				const output = document.getElementById('output2')
				try {
					output.textContent = 'æ­£åœ¨æ‰§è¡Œä»£ç ...'
					const tabs = await getTabs()
					const currentTab = tabs.find((t) => t.active)

					if (!currentTab) {
						throw new Error('æ‰¾ä¸åˆ°å½“å‰ tab')
					}

					const result = await execute(
						currentTab.id,
						'document.title',
					)
					output.textContent = `æ‰§è¡Œç»“æœ:\n${JSON.stringify(
						result,
						null,
						2,
					)}`
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}

			async function testExecuteOther() {
				const output = document.getElementById('output3')
				try {
					output.textContent = 'æ­£åœ¨æ‰§è¡Œä»£ç ...'
					const tabs = await getTabs()

					if (tabs.length < 2) {
						output.textContent = 'è¯·å…ˆæ‰“å¼€è‡³å°‘ 2 ä¸ª tabs'
						return
					}

					const firstTab = tabs[0]
					const result = await execute(firstTab.id, 'document.title')

					output.textContent = `åœ¨ Tab ${firstTab.id} (${
						firstTab.title
					}) ä¸­æ‰§è¡Œç»“æœ:\n${JSON.stringify(result, null, 2)}`
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}
		</script>
	</body>
</html>
