<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Page Agent Test</title>
		<style>
			body {
				font-family: system-ui, -apple-system, sans-serif;
				max-width: 800px;
				margin: 40px auto;
				padding: 20px;
				line-height: 1.6;
			}

			h1 {
				color: #333;
			}

			.section {
				margin: 30px 0;
				padding: 20px;
				background: #f5f5f5;
				border-radius: 8px;
			}

			button {
				padding: 10px 20px;
				margin: 5px;
				font-size: 14px;
				cursor: pointer;
				background: #007bff;
				color: white;
				border: none;
				border-radius: 4px;
			}

			button:hover {
				background: #0056b3;
			}

			pre {
				background: #fff;
				padding: 15px;
				border-radius: 4px;
				overflow-x: auto;
			}

			#output {
				min-height: 100px;
			}
		</style>
	</head>
	<body>
		<h1>ğŸš€ Page Agent Extension Test</h1>

		<div class="section">
			<h2>æ­¥éª¤ 0: è®¤è¯</h2>
			<p>ä»æ’ä»¶å¼¹çª—å¤åˆ¶ Keyï¼Œè¾“å…¥åç‚¹å‡»è®¤è¯</p>
			<input
				type="text"
				id="keyInput"
				placeholder="ç²˜è´´ API Key"
				style="
					width: 100%;
					padding: 8px;
					margin-bottom: 10px;
					font-family: monospace;
				"
			/>
			<button onclick="testLink()">è®¤è¯ Link</button>
			<pre id="output0">ç­‰å¾…è®¤è¯...</pre>
		</div>

		<div class="section">
			<h2>æµ‹è¯• 1: è·å–æ‰€æœ‰ Tabs</h2>
			<button onclick="testListTabs()">è¿è¡Œ listTabs()</button>
			<pre id="output1">å…ˆè®¤è¯åå†æµ‹è¯•...</pre>
		</div>

		<div class="section">
			<h2>æµ‹è¯• 2: åœ¨å½“å‰ Tab æ‰§è¡Œä»£ç </h2>
			<button onclick="testExecuteCurrent()">
				è¿è¡Œ executeScript() - è·å–å½“å‰é¡µé¢æ ‡é¢˜
			</button>
			<pre id="output2">å…ˆè®¤è¯åå†æµ‹è¯•...</pre>
		</div>

		<div class="section">
			<h2>æµ‹è¯• 3: åœ¨å…¶ä»– Tab æ‰§è¡Œä»£ç </h2>
			<p>å…ˆæ‰“å¼€å‡ ä¸ªå…¶ä»– tabï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®</p>
			<button onclick="testExecuteOther()">
				åœ¨ç¬¬ä¸€ä¸ª Tab ä¸­è·å–æ ‡é¢˜
			</button>
			<pre id="output3">å…ˆè®¤è¯åå†æµ‹è¯•...</pre>
		</div>
		<script>
			async function testLink() {
				const output = document.getElementById('output0')
				const keyInput = document.getElementById('keyInput')
				const key = keyInput.value.trim()

				try {
					output.textContent = 'æ­£åœ¨è®¤è¯...'
					const result = await pageAgentExtension.link(key)
					output.textContent = `âœ… è®¤è¯æˆåŠŸï¼\n${JSON.stringify(
						result,
						null,
						2,
					)}`
				} catch (error) {
					output.textContent = `âŒ è®¤è¯å¤±è´¥: ${error.message}`
					console.error(error)
				}
			}

			async function testListTabs() {
				const output = document.getElementById('output1')
				try {
					output.textContent = 'æ­£åœ¨è·å– tabs...'
					const tabs = await pageAgentExtension.listTabs()
					output.textContent = JSON.stringify(tabs, null, 2)
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}

			async function testExecuteCurrent() {
				const output = document.getElementById('output2')
				try {
					output.textContent = 'æ­£åœ¨æ‰§è¡Œä»£ç ...'
					const tabs = await pageAgentExtension.listTabs()
					const currentTab = tabs.find((t) => t.active)

					if (!currentTab) {
						throw new Error('æ‰¾ä¸åˆ°å½“å‰ tab')
					}

					const result = await pageAgentExtension.executeScript(
						currentTab.id,
						'document.title',
					)
					output.textContent = `æ‰§è¡Œç»“æœ:\n${JSON.stringify(
						result,
						null,
						2,
					)}`
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}

			async function testExecuteOther() {
				const output = document.getElementById('output3')
				try {
					output.textContent = 'æ­£åœ¨æ‰§è¡Œä»£ç ...'
					const tabs = await pageAgentExtension.listTabs()

					if (tabs.length < 2) {
						output.textContent = 'è¯·å…ˆæ‰“å¼€è‡³å°‘ 2 ä¸ª tabs'
						return
					}

					const firstTab = tabs[0]
					const result = await pageAgentExtension.executeScript(
						firstTab.id,
						'document.title',
					)

					output.textContent = `åœ¨ Tab ${firstTab.id} (${
						firstTab.title
					}) ä¸­æ‰§è¡Œç»“æœ:\n${JSON.stringify(result, null, 2)}`
				} catch (error) {
					output.textContent = `é”™è¯¯: ${error.message}`
					console.error(error)
				}
			}
		</script>
	</body>
</html>
